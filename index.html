<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>RicoBet ‚Ä¢ Daily Prizes</title>
<meta name="theme-color" content="#121125" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

<style>
  :root{
    --bg:#0f1129; --card:#121125; --ink:#1b1c33; --ring:#2a2e58;
    --tx:#f2f3ff; --mut:#c7cbff; --gold:#ffe26a; --g1:#ff6ec4; --g2:#7873f5; --a3:#78f3ff;
    --row-h:56px;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    background:
      radial-gradient(1200px 600px at 10% -10%,rgba(255,110,196,.10),transparent),
      radial-gradient(900px 500px at 100% 110%,rgba(120,115,245,.10),transparent),
      var(--bg);
    color:var(--tx);
    font:14px/1.45 Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,Helvetica,sans-serif
  }
  .wrap{max-width:1080px; margin:24px auto 40px; padding:0 16px}

  /* Top bar (smaller logo) */
  .topbar{display:flex; justify-content:center; align-items:center; margin-bottom:12px}
  .logo-img{height:36px;width:auto;display:block; filter:drop-shadow(0 3px 8px rgba(0,0,0,.4))}
  @media (max-width:520px){ .logo-img{height:28px} }

  /* Hero */
  .hero{
    position:relative; overflow:hidden; border:1px solid var(--ring); border-radius:18px;
    background:linear-gradient(135deg,rgba(255,110,196,.08),rgba(120,115,245,.08)); padding:18px
  }
  .hero::before{
    /* animated glow frame */
    content:""; position:absolute; inset:-2px; border-radius:20px; padding:2px;
    background:linear-gradient(90deg,var(--g1),var(--g2),var(--a3),var(--g1)); background-size:400% 100%;
    -webkit-mask:linear-gradient(#000 0 0) content-box,linear-gradient(#000 0 0);
    -webkit-mask-composite:xor; mask-composite:exclude; animation:shine 9s linear infinite; pointer-events:none;
  }
  .hero-title{
    margin:0; font-size:28px; font-weight:900; letter-spacing:.3px; line-height:1.15;
    background:linear-gradient(90deg,var(--g1),var(--a3),var(--g2),var(--g1));
    -webkit-background-clip:text; background-clip:text; color:transparent;
    background-size:300% 100%; animation:shine 6s linear infinite
  }
  @keyframes shine{0%{background-position:0% 0}100%{background-position:300% 0}}
  @media (max-width:520px){ .hero-title{font-size:22px} }
  .sub{margin:10px 0 0; color:var(--mut)}

  /* Ring countdown */
  .ring-row{display:flex; justify-content:flex-start; margin-top:10px}
  .ring-timer{display:flex;gap:16px;align-items:center;padding:10px 12px;border-radius:14px;
    background:#161733;border:1px solid rgba(255,255,255,.15);box-shadow:0 10px 30px rgba(0,0,0,.25)}
  .ring{position:relative;width:92px;height:92px;display:grid;place-items:center; animation:float 4s ease-in-out infinite}
  @keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-3px)}}
  .ring svg{width:92px;height:92px;transform:rotate(-90deg)}
  .ring .bg{fill:none;stroke:rgba(255,255,255,.12);stroke-width:8}
  .ring .fg{fill:none;stroke:url(#ring-grad);stroke-width:8;stroke-linecap:round;filter:drop-shadow(0 0 8px rgba(120,115,245,.5))}
  .ring .value{position:absolute;font-weight:900;font-size:22px;letter-spacing:.5px}
  .ring .label{position:absolute;bottom:8px;font-size:10px;color:#c7cbff;letter-spacing:.35px}
  @media (max-width:520px){
    .ring{width:78px;height:78px}
    .ring svg{width:78px;height:78px}
    .ring .value{font-size:18px}
  }

  /* Panel */
  .panel{margin-top:18px; background:var(--card); border:1px solid var(--ring); border-radius:18px; padding:14px; position:relative}
  .panel::before{
    content:""; position:absolute; inset:-2px; border-radius:20px; padding:2px;
    background:linear-gradient(90deg,var(--g1),var(--g2),var(--a3),var(--g1)); background-size:400% 100%;
    -webkit-mask:linear-gradient(#000 0 0) content-box,linear-gradient(#000 0 0);
    -webkit-mask-composite:xor; mask-composite:exclude; animation:shine 9s linear infinite; pointer-events:none;
  }
  .panel-head{display:flex; flex-wrap:wrap; gap:10px; justify-content:space-between; align-items:center; margin-bottom:8px}
  .title{margin:0; font-size:18px; display:flex; align-items:center; gap:8px; flex-wrap:wrap}
  .filters{display:flex; gap:8px; flex-wrap:wrap}
  .chip{display:inline-flex; align-items:center; gap:6px; padding:8px 10px; border-radius:10px; font-size:12px; color:#fff;
        background:#1b1c33; border:1px solid rgba(255,255,255,.12)}
  .board{margin-top:8px; border-radius:14px; overflow:hidden; border:1px solid rgba(255,255,255,.08)}
  .row{display:grid; grid-template-columns:72px 1fr 160px; gap:10px; align-items:center; padding:12px 12px;
       background:linear-gradient(180deg,rgba(255,255,255,.02),transparent);
       border-bottom:1px solid rgba(255,255,255,.06); transition:background .25s, transform .1s}
  .row:hover{background:linear-gradient(180deg,rgba(120,115,245,.10),transparent); transform:translateY(-1px)}
  .row.head{background:rgba(255,255,255,.05); font-weight:900; color:#dfe3ff}
  .row:last-child{border-bottom:none}
  .rank{display:inline-flex; align-items:center; justify-content:center; width:44px; height:28px; border-radius:999px;
        background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.14); font-weight:900}
  .rank.top1{background:linear-gradient(90deg,#ffef9a,#ffd84a); color:#191b32}
  .rank.top2{background:linear-gradient(90deg,#e5e9ff,#cbd2ff); color:#191b32}
  .rank.top3{background:linear-gradient(90deg,#ffd3b5,#ffae7a); color:#191b32}
  .player{display:flex; align-items:center; gap:10px}
  .avatar{width:28px; height:28px; border-radius:8px; background:linear-gradient(135deg,var(--g2),var(--a3)); box-shadow:0 0 10px rgba(120,115,245,.25)}
  .mask{opacity:.95; font-weight:700; letter-spacing:.2px}
  .payout{font-variant-numeric:tabular-nums; font-weight:800}
  .viewport{max-height:calc(var(--row-h) * 5); overflow-y:auto}
  .viewport::-webkit-scrollbar{height:8px;width:8px}
  .viewport::-webkit-scrollbar-thumb{background:#2b2d4e;border-radius:10px}
  .hit{outline:2px solid var(--a3); border-radius:8px}

  /* CTA (only two buttons + small support sentence) */
  .cta-block{margin-top:18px; display:flex; gap:12px; flex-wrap:wrap; justify-content:center}
  .btn{display:inline-block; padding:12px 18px; border-radius:12px; text-decoration:none;
    font-weight:800; font-size:14px; color:#fff; border:1px solid rgba(255,255,255,.25);
    transform:translateZ(0); transition:transform .12s ease, box-shadow .2s ease}
  .btn:hover{transform:translateY(-1px); box-shadow:0 10px 24px rgba(0,0,0,.35), 0 0 20px rgba(120,115,245,.35)}
  .btn--pri{background:linear-gradient(90deg,var(--g1),var(--g2))}
  .btn--dark{background:#1a1b34}
  .support-note{margin-top:6px; text-align:center; color:#cfd3ff}

  /* Divider + minimalist FAQ (no box) */
  .divider{height:1px; background:linear-gradient(90deg,transparent,rgba(255,255,255,.22),transparent); margin:26px 0 14px}
  .faq h3{margin:0 0 10px 0; font-size:18px}
  .faq details{background:#141534; border:1px solid rgba(255,255,255,.12);
        border-radius:12px; padding:10px 12px; margin:8px 0}
  .faq summary{cursor:pointer; font-weight:700}
  .faq p{margin:8px 0 0 0; color:#dfe3ff}
</style>
</head>
<body>
  <div class="wrap">
    <!-- Logo -->
    <div class="topbar" aria-label="RicoBet">
      <img src="https://ricobr.ft-crm.com/media-api/serve/c5570255-af15-4915-8b16-907d5bc7f999_Rico_Logo.png" alt="RicoBet" class="logo-img" />
    </div>

    <!-- Title + Countdown -->
    <section class="hero">
      <h1 class="hero-title">Daily Prizes of USD 10,000</h1>

      <div class="ring-row">
        <div class="ring-timer" aria-label="Countdown to midnight">
          <div class="ring" data-unit="h">
            <svg viewBox="0 0 72 72" aria-hidden="true">
              <defs><linearGradient id="ring-grad" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#ff6ec4"/><stop offset="100%" stop-color="#7873f5"/></linearGradient></defs>
              <circle class="bg" cx="36" cy="36" r="30"></circle>
              <circle class="fg" cx="36" cy="36" r="30"></circle>
            </svg>
            <div class="value">00</div>
            <div class="label">HRS</div>
          </div>
          <div class="ring" data-unit="m">
            <svg viewBox="0 0 72 72" aria-hidden="true">
              <circle class="bg" cx="36" cy="36" r="30"></circle>
              <circle class="fg" cx="36" cy="36" r="30"></circle>
            </svg>
            <div class="value">00</div>
            <div class="label">MIN</div>
          </div>
          <div class="ring" data-unit="s">
            <svg viewBox="0 0 72 72" aria-hidden="true">
              <circle class="bg" cx="36" cy="36" r="30"></circle>
              <circle class="fg" cx="36" cy="36" r="30"></circle>
            </svg>
            <div class="value">00</div>
            <div class="label">SEC</div>
          </div>
        </div>
      </div>

      <p class="sub">Play in Pragmatic Play Slot Games to win the daily prizes !</p>
    </section>

    <!-- Winners -->
    <section class="panel">
      <div class="panel-head">
        <h2 class="title">üèÜ Top 20 ‚Ä¢ <span id="boardDate">‚Äî</span></h2>
        <div class="filters">
          <span class="chip">üîÑ Last update: <b id="lastUpdated">‚Äî</b></span>
          <a class="chip" href="#" id="refresh">‚ü≥ Refresh</a>
          <label class="chip" title="Pick a date">
            üìÖ&nbsp;<input id="datePicker" type="date" style="background:transparent;border:0;color:#fff;outline:none">
          </label>
          <span class="chip" id="quickToday" style="cursor:pointer">üìÜ Today</span>
          <span class="chip" id="quickYesterday" style="cursor:pointer">üóìÔ∏è Yesterday</span>
        </div>
      </div>

      <!-- Search -->
      <div class="search-wrap" style="display:flex;gap:8px;align-items:center;margin:6px 0 10px;">
        <input class="search-input" id="searchInput" type="text" placeholder="Search your full username‚Ä¶" />
        <button class="search-btn" id="searchBtn">Search</button>
        <span class="search-result" id="searchResult" style="margin-left:6px;color:#dfe3ff;font-weight:700"></span>
      </div>

      <div class="board">
        <div class="row head">
          <div>#</div>
          <div>Player</div>
          <div>Turnover</div>
        </div>
        <div id="rows" class="viewport" aria-live="polite"></div>
      </div>
    </section>

    <!-- CTA -->
    <div class="cta-block">
      <a class="btn btn--pri" href="https://www.rico.bet/" target="_blank" rel="noopener">‚ñ∂ PLAY NOW</a>
      <a class="btn btn--dark" href="https://t.me/+55A937ipq8xhMzJl" target="_blank" rel="noopener">üë• JOIN COMMUNITY</a>
    </div>
    <div class="support-note">Need help? Message our support on Telegram and we‚Äôll assist you.</div>

    <!-- Divider + FAQ (no surrounding box) -->
    <div class="divider"></div>
    <section class="faq">
      <h3>FAQ &amp; Terms</h3>

      <details>
        <summary>What is the Daily Prizes event?</summary>
        <p>Top players are ranked by daily <b>Turnover</b> on eligible Pragmatic Play slot games. The board resets at 00:00 (server time).</p>
      </details>

      <details>
        <summary>How do I qualify?</summary>
        <p>Place real-money bets on participating Pragmatic Play slots during the event day.</p>
      </details>

      <details>
        <summary>How is Turnover calculated?</summary>
        <p>Turnover is the total amount wagered per player on the qualified games during the selected day.</p>
      </details>

      <details>
        <summary>When are winners confirmed?</summary>
        <p>Winners are finalized after the daily reset. Any suspicious or abusive activity may void eligibility.</p>
      </details>

      <details>
        <summary>Full Terms &amp; Conditions</summary>
        <p>
          ‚Ä¢ Event runs from the configured start to end dates below.<br>
          ‚Ä¢ Only real-money wagers count toward Turnover.<br>
          ‚Ä¢ Pragmatic Play slot availability may vary by region.<br>
          ‚Ä¢ Accounts must be verified and in good standing.<br>
          ‚Ä¢ The operator may amend/cancel the event to prevent abuse or fraud.<br>
          ‚Ä¢ Local laws and platform rules apply.
        </p>
      </details>
    </section>
  </div>

<script>
/* =========================
   RICOBET ‚Äî CONFIG
   ========================= */
const RICOBET_DATA_CSV =
  "https://docs.google.com/spreadsheets/d/e/2PACX-1vRmj-_miuOyDdV2cshF2M_g6aaVcNqtChyeg5PII28oaWQHPFVPiQzogRBLOATha5ug0Vh2t6HUgIIP/pub?output=csv";

const EVENT_START_YMD  = "2025-09-23";  // first date available in your sheet
const EVENT_END_YMD    = "2025-10-31";  // last date available in your sheet

// Mexico City (will automatically handle DST; UTC-6 in winter, UTC-5 in summer)
const TZ = "America/Mexico_City";

// Currency symbol for turnover display
const CURRENCY = { symbol: "$", code: "USD" };

/* =========================
   DOM SHORTCUTS
   ========================= */
const $ = (s) => document.querySelector(s);
const rowsEl        = $("#rows");
const updatedEl     = $("#lastUpdated");
const boardDateEl   = $("#boardDate");
const refreshBtn    = $("#refresh");
const datePicker    = $("#datePicker");
const quickTodayBtn = $("#quickToday");
const quickYestBtn  = $("#quickYesterday");
const searchInput   = $("#searchInput");
const searchBtn     = $("#searchBtn");
const searchResult  = $("#searchResult");

/* =========================
   HELPERS (time, formatters)
   ========================= */
const pad2 = (n) => String(n).padStart(2, "0");
const fmtMoney = (n) =>
  `${CURRENCY.symbol} ${Number(n || 0).toLocaleString(undefined, {
    minimumFractionDigits: 2,
    maximumFractionDigits: 2,
  })}`;

function nowInTZ() {
  const now = new Date();
  const toParts = (zone) =>
    new Intl.DateTimeFormat("en-CA", {
      timeZone: zone,
      hourCycle: "h23",
      year: "numeric",
      month: "2-digit",
      day: "2-digit",
      hour: "2-digit",
      minute: "2-digit",
      second: "2-digit",
    })
      .formatToParts(now)
      .reduce((a, p) => ((a[p.type] = p.value), a), {});
  const utc = toParts("UTC");
  const tz = toParts(TZ);
  const utcEpoch = Date.parse(
    `${utc.year}-${utc.month}-${utc.day}T${utc.hour}:${utc.minute}:${utc.second}Z`
  );
  const tzEpoch = Date.parse(
    `${tz.year}-${tz.month}-${tz.day}T${tz.hour}:${tz.minute}:${tz.second}Z`
  );
  return new Date(now.getTime() + (tzEpoch - utcEpoch));
}

const ymdInTZ = (d) =>
  new Intl.DateTimeFormat("en-CA", {
    timeZone: TZ,
    year: "numeric",
    month: "2-digit",
    day: "2-digit",
  }).format(d);

const cmpYmd = (a, b) => a.localeCompare(b);
const clampYmd = (ymd) =>
  cmpYmd(ymd, EVENT_START_YMD) < 0
    ? EVENT_START_YMD
    : cmpYmd(ymd, EVENT_END_YMD) > 0
    ? EVENT_END_YMD
    : ymd;

function fmtDateTimeInTZ(dateObj) {
  // US-style like your screenshot: 9/23/2025, 4:16:34 PM
  return new Intl.DateTimeFormat("en-US", {
    timeZone: TZ,
    dateStyle: "short",
    timeStyle: "medium",
  }).format(dateObj);
}

/* =========================
   COUNTDOWN (neon rings)
   ========================= */
function nextMidnightInsideWindow() {
  const n = nowInTZ();
  const today = ymdInTZ(n);
  if (cmpYmd(today, EVENT_START_YMD) < 0) {
    // Before event window: count down to start
    const [Y, M, D] = EVENT_START_YMD.split("-").map(Number);
    return new Date(Date.UTC(Y, M - 1, D, 0, 0, 0));
  }
  if (cmpYmd(today, EVENT_END_YMD) > 0) {
    // After event window
    return null;
  }
  const [Y, M, D] = today.split("-").map(Number);
  return new Date(Date.UTC(Y, M - 1, D + 1, 0, 0, 0));
}

function splitHMS(ms) {
  if (ms < 0) ms = 0;
  const h = Math.floor(ms / 3600000);
  const m = Math.floor((ms % 3600000) / 60000);
  const s = Math.floor((ms % 60000) / 1000);
  return { h, m, s };
}

(function startRings() {
  const rH = document.querySelector('.ring[data-unit="h"]');
  const rM = document.querySelector('.ring[data-unit="m"]');
  const rS = document.querySelector('.ring[data-unit="s"]');
  if (!rH || !rM || !rS) return;

  const R = 30;
  const C = 2 * Math.PI * R;
  const setStroke = (el, p) => {
    el.style.strokeDasharray = `${C}`;
    el.style.strokeDashoffset = `${C * (1 - Math.max(0, Math.min(1, p)))}`;
  };
  const update = ($ring, val, max) => {
    if (!$ring) return;
    $ring.querySelector(".value").textContent = pad2(val);
    setStroke($ring.querySelector(".fg"), val / max);
  };

  (function tick() {
    const tgt = nextMidnightInsideWindow();
    if (!tgt) {
      [rH, rM, rS].forEach((r) => {
        r.querySelector(".value").textContent = "‚Äî";
        r.querySelector(".label").textContent = "ENDED";
        setStroke(r.querySelector(".fg"), 0);
      });
      return;
    }
    const diff = tgt - nowInTZ();
    const { h, m, s } = splitHMS(diff);
    update(rH, h, 24);
    update(rM, m, 60);
    update(rS, s, 60);
    requestAnimationFrame(() => setTimeout(tick, 250));
  })();
})();

/* =========================
   CSV LOADER (Google Sheet)
   ========================= */

// Small, safe CSV parser (handles quoted commas/newlines)
function parseCSV(text) {
  const rows = [];
  let row = [];
  let cell = "";
  let i = 0;
  let inQuotes = false;

  while (i < text.length) {
    const ch = text[i];

    if (inQuotes) {
      if (ch === '"') {
        if (text[i + 1] === '"') {
          cell += '"';
          i += 2;
        } else {
          inQuotes = false;
          i++;
        }
      } else {
        cell += ch;
        i++;
      }
    } else {
      if (ch === '"') {
        inQuotes = true;
        i++;
      } else if (ch === ",") {
        row.push(cell);
        cell = "";
        i++;
      } else if (ch === "\r") {
        i++; // skip
      } else if (ch === "\n") {
        row.push(cell);
        rows.push(row);
        row = [];
        cell = "";
        i++;
      } else {
        cell += ch;
        i++;
      }
    }
  }
  // last cell
  row.push(cell);
  rows.push(row);
  return rows;
}

let SHEET_CACHE = null; // { map: { 'YYYY-MM-DD': [rows...] }, lastFetched: Date }

async function loadSheet() {
  const url = `${RICOBET_DATA_CSV}&_=${Date.now()}`; // cache-bust
  const res = await fetch(url, { cache: "no-store" });
  if (!res.ok) throw new Error("Failed to load Google Sheet CSV");
  const text = await res.text();
  const grid = parseCSV(text);

  // Expect headers: date, rank, username, turnover
  const headers = grid.shift().map((h) => h.trim().toLowerCase());
  const iDate = headers.indexOf("date");
  const iRank = headers.indexOf("rank");
  const iName = headers.indexOf("username");
  const iAmt = headers.indexOf("turnover");
  if (iDate < 0 || iName < 0 || iAmt < 0) {
    throw new Error("Missing required columns: date, username, turnover");
  }

  const map = {};
  for (const r of grid) {
    const date = (r[iDate] || "").trim();
    const name = (r[iName] || "").trim();
    const rankRaw = (r[iRank] || "").trim();
    const amtRaw = (r[iAmt] || "").trim();

    if (!date) continue; // ignore blank rows / separators
    if (!map[date]) map[date] = [];

    const amount = Number(String(amtRaw).replace(/[^0-9.]/g, "")) || 0;
    const rank = Number(rankRaw) || null; // allow gaps like #37, #56
    if (!name && !amount) continue; // nothing meaningful on this line

    map[date].push({ rank, name, amount });
  }

  SHEET_CACHE = { map, lastFetched: new Date() };
  return SHEET_CACHE;
}

/* =========================
   RENDERING
   ========================= */
function maskUsername(name) {
  if (!name) return "Player";
  const s = String(name);
  if (s.length <= 6) {
    const k = Math.max(1, Math.floor(s.length / 3));
    return `${s.slice(0, k)}****${s.slice(-k)}`;
  }
  const left = Math.floor((s.length - 4) / 2);
  return s.slice(0, left) + "****" + s.slice(left + 4);
}

function sortByAmountDesc(a, b) {
  return (b.amount || 0) - (a.amount || 0);
}

function computedRank(index, row) {
  // Prefer explicit rank from sheet; else fallback to index+1 (after sorting)
  return row.rank && row.rank > 0 ? row.rank : index + 1;
}

function renderRowsForDay(rows) {
  rowsEl.innerHTML = "";

  // Sort all rows by turnover to compute fallback ranks, but slice Top 20 for display
  const sorted = rows.slice().sort(sortByAmountDesc);
  const top20 = sorted.slice(0, 20);

  for (let i = 0; i < top20.length; i++) {
    const r = top20[i];
    const rank = computedRank(i, r);

    const row = document.createElement("div");
    row.className = "row";
    row.dataset.nameOriginal = r.name;

    row.innerHTML = `
      <div>
        <span class="rank ${rank === 1 ? "top1" : rank === 2 ? "top2" : rank === 3 ? "top3" : ""}">
          ${rank}
        </span>
      </div>
      <div class="player">
        <span class="avatar" aria-hidden="true"></span>
        <span class="mask">${maskUsername(r.name)}</span>
      </div>
      <div class="payout">${fmtMoney(r.amount)}</div>
    `;
    rowsEl.appendChild(row);
  }
}

async function renderForDate(ymd) {
  const clamped = clampYmd(ymd);
  if (datePicker) datePicker.value = clamped;
  if (boardDateEl) boardDateEl.textContent = clamped;

  try {
    const cache = SHEET_CACHE || (await loadSheet());
    const rows = cache.map[clamped] || [];

    if (!rows.length) {
      rowsEl.innerHTML = `<div class="row"><div></div><div>No results for ${clamped}.</div><div></div></div>`;
    } else {
      renderRowsForDay(rows);
    }

    // Show the time we last fetched, formatted in Mexico City time
    if (updatedEl) updatedEl.textContent = fmtDateTimeInTZ(cache.lastFetched);
  } catch (e) {
    console.error(e);
    rowsEl.innerHTML = `<div class="row"><div></div><div>Could not load leaderboard.</div><div></div></div>`;
    if (updatedEl) updatedEl.textContent = "‚Äî";
  }
}

/* =========================
   SEARCH (full username, exact match, any rank)
   ========================= */
async function doSearch() {
  const q = (searchInput?.value || "").trim();
  if (!q) {
    if (searchResult) searchResult.textContent = "";
    return;
  }

  try {
    const cache = SHEET_CACHE || (await loadSheet());
    const ymd = datePicker?.value || ymdInTZ(nowInTZ());
    const rows = cache.map[clampYmd(ymd)] || [];
    if (!rows.length) {
      if (searchResult) searchResult.textContent = "No data for selected date.";
      return;
    }

    // Rank logic: prefer explicit rank; otherwise use position in amount-desc order
    const sorted = rows.slice().sort(sortByAmountDesc);
    let foundRank = null;

    // Look by exact case-insensitive match on the original username
    for (let i = 0; i < sorted.length; i++) {
      const r = sorted[i];
      if (String(r.name).toLowerCase() === q.toLowerCase()) {
        foundRank = r.rank && r.rank > 0 ? r.rank : i + 1;
        break;
      }
    }

    if (foundRank == null) {
      if (searchResult) searchResult.textContent = `No exact match for "${q}" on ${ymd}.`;
      return;
    }

    if (searchResult) {
      searchResult.textContent =
        foundRank <= 20 ? `‚úÖ ${q} is #${foundRank} today.` : `‚ÑπÔ∏è ${q} is #${foundRank} today ‚Äî not in Top 20.`;
    }

    // If Top-20 and visible on the list, highlight it
    if (foundRank <= 20) {
      const row = Array.from(rowsEl.children).find(
        (el) => el.dataset && el.dataset.nameOriginal && el.dataset.nameOriginal.toLowerCase() === q.toLowerCase()
      );
      if (row) {
        rowsEl.querySelectorAll(".hit").forEach((e) => e.classList.remove("hit"));
        row.classList.add("hit");
        row.scrollIntoView({ behavior: "smooth", block: "center" });
        setTimeout(() => row.classList.remove("hit"), 2500);
      }
    }
  } catch (e) {
    console.error(e);
    if (searchResult) searchResult.textContent = "Search error. Try again.";
  }
}

/* =========================
   INIT
   ========================= */
document.addEventListener("DOMContentLoaded", async () => {
  // Date picker window
  if (datePicker) {
    datePicker.min = EVENT_START_YMD;
    datePicker.max = EVENT_END_YMD;
  }
  const todayClamped = clampYmd(ymdInTZ(nowInTZ()));
  if (datePicker) datePicker.value = todayClamped;

  // First render
  await renderForDate(todayClamped);

  // UI events
  refreshBtn?.addEventListener("click", async (e) => {
    e.preventDefault();
    // Force re-fetch from Google Sheet
    SHEET_CACHE = null;
    await renderForDate(datePicker.value);
  });

  datePicker?.addEventListener("change", () => renderForDate(datePicker.value));

  quickTodayBtn?.addEventListener("click", () => {
    const y = clampYmd(ymdInTZ(nowInTZ()));
    if (datePicker) datePicker.value = y;
    renderForDate(y);
  });

  quickYestBtn?.addEventListener("click", () => {
    const n = nowInTZ();
    n.setUTCDate(n.getUTCDate() - 1);
    const y = clampYmd(ymdInTZ(n));
    if (datePicker) datePicker.value = y;
    renderForDate(y);
  });

  searchBtn?.addEventListener("click", doSearch);
  searchInput?.addEventListener("keydown", (e) => {
    if (e.key === "Enter") doSearch();
  });
});
</script>

</body>
</html>
