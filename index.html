<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>RicoBet ‚Ä¢ Spins Of Glory</title>
<meta name="theme-color" content="#121125" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

<style>
  :root{
    --bg-image: url("https://ricobr.ft-crm.com/media-api/serve/85c9bc7e-50c8-46fb-933c-359f7c0f9767_1.jpg");
    --bg:#0f1129; --card:#121125; --ring:#2a2e58;
    --tx:#f2f3ff; --mut:#c7cbff; --g1:#ff6ec4; --g2:#7873f5; --a3:#78f3ff;
    --row-h:56px;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    /* lock the background so it doesn't "move" when content expands */
    background:
      radial-gradient(1200px 600px at 10% -10%,rgba(255,110,196,.10),transparent),
      radial-gradient(900px 500px at 100% 110%,rgba(120,115,245,.10),transparent),
      var(--bg);
    background-image:
      radial-gradient(1200px 600px at 10% -10%,rgba(255,110,196,.10),transparent),
      radial-gradient(900px 500px at 100% 110%,rgba(120,115,245,.10),transparent),
      var(--bg-image);
    background-size: auto, auto, cover;
    background-position:center;
    /* this line fixes the ‚Äúexpanding/moving‚Äù feel */
    background-attachment: fixed, fixed, fixed;
    color:var(--tx);
    font:14px/1.45 Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,Helvetica,sans-serif
  }
  .wrap{max-width:1080px; margin:24px auto 46px; padding:0 16px}

  .topbar{display:flex; justify-content:center; align-items:center; margin-bottom:12px}
  .logo-img{height:36px;width:auto;display:block}
  @media (max-width:520px){ .logo-img{height:28px} }

  .card{position:relative; border:1px solid var(--ring); border-radius:18px; background:rgba(18,17,37,.86)}
  .glow::before{
    content:""; position:absolute; inset:-2px; border-radius:20px; padding:2px;
    background:linear-gradient(90deg,var(--g1),var(--g2),var(--a3),var(--g1)); background-size:400% 100%;
    -webkit-mask:linear-gradient(#000 0 0) content-box,linear-gradient(#000 0 0);
    -webkit-mask-composite:xor; mask-composite:exclude; animation:shine 9s linear infinite; pointer-events:none;
  }
  @keyframes shine{0%{background-position:0% 0}100%{background-position:400% 0}}

  /* ===== HERO ===== */
  .hero.card{padding:18px; text-align:center}

  .title-3d{
    margin:2px 0 4px; font-weight:900; letter-spacing:.4px; color:#fff;
    text-shadow:
      0 1px 0 #c9c9ff, 0 2px 0 #b6b6ff, 0 3px 0 #a3a3ff, 0 4px 0 #9090ff,
      0 10px 20px rgba(0,0,0,.35), 0 0 24px rgba(120,115,245,.45);
    filter: drop-shadow(0 6px 12px rgba(0,0,0,.25));
    animation:floaty 5s ease-in-out infinite;
    font-size:42px; line-height:1.05;
  }
  @keyframes floaty{0%,100%{transform:translateY(0)}50%{transform:translateY(-2px)}}
  @media (max-width:720px){ .title-3d{font-size:34px} }
  @media (max-width:520px){ .title-3d{font-size:28px} }

  .hero-subtitle{
    margin:6px auto 8px; font-weight:800; font-size:18px;
    background:linear-gradient(90deg,var(--g1),var(--a3),var(--g2),var(--g1));
    -webkit-background-clip:text; background-clip:text; color:transparent;
    background-size:300% 100%; animation:shine 6s linear infinite
  }
  @media (max-width:520px){ .hero-subtitle{font-size:16px} }
  .sub{margin:12px 0 0; color:var(--mut)}

  /* COUNTDOWN */
  .ring-row{display:flex; justify-content:center; margin-top:10px}
  .ring-timer{display:flex;gap:16px;align-items:center;padding:10px 12px;border-radius:14px;
    background:#161733;border:1px solid rgba(255,255,255,.15);box-shadow:0 10px 30px rgba(0,0,0,.25)}
  .ring{position:relative;width:92px;height:92px;display:grid;place-items:center}
  .ring svg{width:92px;height:92px;transform:rotate(-90deg)}
  .ring .bg{fill:none;stroke:rgba(255,255,255,.12);stroke-width:8}
  .ring .fg{fill:none;stroke:url(#ring-grad);stroke-width:8;stroke-linecap:round;filter:drop-shadow(0 0 8px rgba(120,115,245,.5))}
  .value{position:absolute;font-weight:900;font-size:22px;letter-spacing:.5px;transition:transform .25s ease}
  .value.bump{transform:translateY(-3px)}
  .ring .label{position:absolute;bottom:8px;font-size:10px;color:#c7cbff;letter-spacing:.35px}
  @media (max-width:520px){ .ring{width:78px;height:78px} .ring svg{width:78px;height:78px} .value{font-size:18px} }

  /* ===== WINNERS ===== */
  .panel.card{padding:14px}
  .panel-head{display:flex; flex-wrap:wrap; gap:10px; justify-content:space-between; align-items:center; margin-bottom:8px}
  .title{margin:0; font-size:18px; display:flex; align-items:center; gap:8px; flex-wrap:wrap}
  .filters{display:flex; gap:8px; flex-wrap:wrap}
  .chip{display:inline-flex; align-items:center; gap:6px; padding:8px 10px; border-radius:10px; font-size:12px; color:#fff;
        background:#1b1c33; border:1px solid rgba(255,255,255,.12)}
  .chip button{all:unset; cursor:pointer}

  .board-wrap{overflow:hidden}
  .board{width:100%; border-radius:14px; overflow:hidden; border:1px solid rgba(255,255,255,.08)}
  .row{
    display:grid; grid-template-columns:72px 1fr 180px; gap:10px; align-items:center;
    padding:12px 12px; background:linear-gradient(180deg,rgba(255,255,255,.02),transparent);
    border-bottom:1px solid rgba(255,255,255,.06)
  }
  .row.head{background:rgba(255,255,255,.05); font-weight:900; color:#dfe3ff}
  .row:last-child{border-bottom:none}
  .rank{display:inline-flex; align-items:center; justify-content:center; width:44px; height:28px; border-radius:999px;
        background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.14); font-weight:900}
  .rank.top1{background:linear-gradient(90deg,#ffef9a,#ffd84a); color:#191b32}
  .rank.top2{background:linear-gradient(90deg,#e5e9ff,#cbd2ff); color:#191b32}
  .rank.top3{background:linear-gradient(90deg,#ffd3b5,#ffae7a); color:#191b32}

  .player{display:flex; align-items:center; gap:10px; min-width:0}
  .avatar{flex:0 0 auto; width:26px; height:26px; border-radius:8px; background:linear-gradient(135deg,var(--g2),var(--a3))}
  .mask{
    flex:1 1 auto; font-weight:800; letter-spacing:.2px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    font-size:13px;
  }
  .payout{font-variant-numeric:tabular-nums; font-weight:800; text-align:right}
  @media (max-width:560px){ .row{grid-template-columns:58px 1fr 132px; padding:10px} .mask{font-size:12px} }

  .viewport{max-height:calc(var(--row-h) * 5); overflow-y:auto}
  .viewport::-webkit-scrollbar{height:8px;width:8px}
  .viewport::-webkit-scrollbar-thumb{background:#2b2d4e;border-radius:10px}
  .hit{outline:2px solid var(--a3); border-radius:8px}

  .search-wrap{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
  .search-input{appearance:none; background:#141534; border:1px solid rgba(255,255,255,.15); color:#fff;
    border-radius:10px; padding:8px 10px; min-width:220px; outline:none}
  .search-btn{cursor:pointer; background:linear-gradient(90deg,var(--g1),var(--g2)); border:0; color:#fff;
    font-weight:900; border-radius:10px; padding:8px 12px}

  .cta-row{margin-top:18px; display:flex; gap:12px; flex-wrap:wrap; justify-content:center; align-items:center}
  .btn{display:inline-flex; align-items:center; gap:8px; padding:12px 18px; border-radius:12px; text-decoration:none;
      font-weight:800; font-size:14px; color:#fff; border:1px solid rgba(255,255,255,.25); transition:transform .15s ease}
  .btn:hover{transform:translateY(-2px)}
  .btn--pri{
    background:linear-gradient(90deg,var(--g1),var(--g2));
    box-shadow:0 0 0 0 rgba(120,115,245,.55);
    animation:pulse 2.4s ease-in-out infinite;
  }
  @keyframes pulse{
    0%{box-shadow:0 0 0 0 rgba(120,115,245,.55)}
    70%{box-shadow:0 0 0 18px rgba(120,115,245,0)}
    100%{box-shadow:0 0 0 0 rgba(120,115,245,0)}
  }
  .btn--dark{background:#1a1b34}

  .support{
    margin-top:10px; text-align:center; color:#cfd3ff;
    text-shadow: 0 1px 0 rgba(0,0,0,.8), 0 6px 18px rgba(0,0,0,.35);
  }
  .support a{color:#a5b0ff; font-weight:800; text-decoration:underline}

  .sharebar{
    margin-top:18px; display:flex; align-items:center; justify-content:space-between; gap:12px;
    padding:14px 16px; border-radius:14px; background:#0f216a; border:1px solid #2c3ea0; color:#fff;
    box-shadow:0 10px 25px rgba(0,0,0,.25);
  }
  .sharebar b{font-size:18px; letter-spacing:.5px; text-shadow:0 2px 0 rgba(0,0,0,.35)}
  .share-actions{display:flex; gap:10px}
  .sharebtn{
    display:inline-flex; align-items:center; justify-content:center; width:42px; height:42px; border-radius:999px;
    background:#142b90; border:1px solid rgba(255,255,255,.18); text-decoration:none; transition:transform .15s ease;
  }
  .sharebtn:hover{transform:translateY(-2px)}
  .sharebtn img{width:22px;height:22px; filter: drop-shadow(0 1px 0 rgba(0,0,0,.35))}
  .tg{background:#229ED9} .wa{background:#25D366}

  .divider{height:1px; margin:26px 0 8px; background:linear-gradient(90deg,transparent,#394080,transparent)}

  /* ===== FAQ PANEL (two-level accordion, fixed-height body) ===== */
  .faq-panel{
    border-radius:18px; overflow:hidden;
  }
  .faq-panel > summary{
    list-style:none; cursor:pointer; padding:14px 16px; font-weight:900; font-size:16px;
    background:#17183a; color:#fff; display:flex; align-items:center; justify-content:space-between;
  }
  .faq-panel > summary::after{
    content:"‚ñæ"; opacity:.9; transition:transform .2s ease;
  }
  .faq-panel[open] > summary::after{ transform:rotate(180deg) }
  .faq-body{
    padding:12px 14px;
    /* The key: cap the height so the page doesn‚Äôt jump; scroll internally */
    max-height:60vh; overflow:auto;
    background:#0f1030;
  }
  .faq-toolbar{
    display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin:0 0 10px
  }
  .faq-toolbar .mini{font-size:12px;padding:6px 10px;border-radius:10px;border:1px solid rgba(255,255,255,.18);background:#141534;color:#fff;cursor:pointer}
  .toc{display:flex; flex-wrap:wrap; gap:8px; margin-bottom:8px}
  .toc a{
    display:inline-block; padding:6px 10px; border-radius:999px; font-weight:700; font-size:12px;
    color:#e8eaff; background:#1b1d3a; border:1px solid rgba(255,255,255,.12); text-decoration:none
  }
  .faq-item{
    background:#141534; border:1px solid rgba(255,255,255,.12); border-radius:12px;
    padding:10px 12px; margin:8px 0; box-shadow:0 8px 24px rgba(0,0,0,.2)
  }
  .faq-item > summary{cursor:pointer; font-weight:800}
  .faq-item p{margin:8px 0 0 0; color:#dfe3ff}
</style>
</head>
<body>
  <div class="wrap">
    <div class="topbar" aria-label="RicoBet">
      <img src="https://ricobr.ft-crm.com/media-api/serve/c5570255-af15-4915-8b16-907d5bc7f999_Rico_Logo.png" alt="RicoBet" class="logo-img" />
    </div>

    <!-- HERO (unchanged) -->
    <section class="hero card glow">
      <h1 class="title-3d">Spins Of Glory</h1>
      <div class="hero-subtitle">Daily Prizes of USD 5,000</div>

      <div class="ring-row">
        <div class="ring-timer" aria-label="Countdown to midnight (Brazil)">
          <div class="ring" data-unit="h">
            <svg viewBox="0 0 72 72" aria-hidden="true">
              <defs><linearGradient id="ring-grad" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#ff6ec4"/><stop offset="100%" stop-color="#7873f5"/></linearGradient></defs>
              <circle class="bg" cx="36" cy="36" r="30"></circle>
              <circle class="fg" cx="36" cy="36" r="30"></circle>
            </svg>
            <div class="value">00</div><div class="label">HRS</div>
          </div>
          <div class="ring" data-unit="m">
            <svg viewBox="0 0 72 72" aria-hidden="true">
              <circle class="bg" cx="36" cy="36" r="30"></circle>
              <circle class="fg" cx="36" cy="36" r="30"></circle>
            </svg>
            <div class="value">00</div><div class="label">MIN</div>
          </div>
          <div class="ring" data-unit="s">
            <svg viewBox="0 0 72 72" aria-hidden="true">
              <circle class="bg" cx="36" cy="36" r="30"></circle>
              <circle class="fg" cx="36" cy="36" r="30"></circle>
            </svg>
            <div class="value">00</div><div class="label">SEC</div>
          </div>
        </div>
      </div>
      <p class="sub">Play in Pragmatic Play Slot Games to win the daily prizes !</p>
    </section>

    <!-- WINNERS (unchanged layout) -->
    <section class="panel card glow" style="margin-top:18px">
      <div class="panel-head">
        <h2 class="title">üèÜ Top 20 ‚Ä¢ <span id="boardDate">‚Äî</span></h2>
        <div class="filters">
          <span class="chip">üß≠ Last update: <b id="lastUpdated">‚Äî</b></span>
          <span class="chip"><button id="refresh">‚ü≥ Refresh</button></span>
          <label class="chip" title="Pick a date">üìÖ&nbsp;<input id="datePicker" type="date" style="background:transparent;border:0;color:#fff;outline:none"></label>
          <span class="chip" id="quickToday" style="cursor:pointer">üìÜ Today</span>
          <span class="chip" id="quickYesterday" style="cursor:pointer">üóìÔ∏è Yesterday</span>
        </div>
      </div>

      <div class="search-wrap" style="margin:6px 0 10px;">
        <input class="search-input" id="searchInput" type="text" placeholder="Search your full username‚Ä¶" />
        <button class="search-btn" id="searchBtn">Search</button>
        <span class="search-result" id="searchResult"></span>
      </div>

      <div class="board-wrap">
        <div class="board">
          <div class="row head">
            <div>#</div><div>Player</div><div style="text-align:right">Turnover</div>
          </div>
          <div id="rows" class="viewport" aria-live="polite"></div>
        </div>
      </div>
    </section>

    <!-- CTAs -->
    <div class="cta-row">
      <a class="btn btn--pri" href="https://www.rico.bet/" target="_blank" rel="noopener">‚ñ∂ PLAY NOW</a>
      <a class="btn btn--dark" href="https://t.me/+55A937ipq8xhMzJl" target="_blank" rel="noopener">üë• JOIN COMMUNITY</a>
    </div>
    <p class="support">Need help? Message our support on Telegram and we‚Äôll assist you: <a href="https://t.me/+55A937ipq8xhMzJl" target="_blank" rel="noopener">Contact Support</a></p>

    <!-- Share -->
    <div class="sharebar">
      <b>SHARE WITH YOUR FRIENDS</b>
      <div class="share-actions">
        <a id="shareTg" class="sharebtn tg" title="Share on Telegram" target="_blank" rel="noopener">
          <img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/telegram.svg" alt="Telegram">
        </a>
        <a id="shareWa" class="sharebtn wa" title="Share on WhatsApp" target="_blank" rel="noopener">
          <img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/whatsapp.svg" alt="WhatsApp">
        </a>
      </div>
    </div>

    <div class="divider"></div>

    <!-- ===== NEW: Single ‚ÄúFAQ & Terms‚Äù box which opens, then inner Q/A accordions ===== -->
    <details class="faq-panel card glow">
      <summary>FAQ &amp; Terms</summary>
      <div class="faq-body">
        <div class="faq-toolbar">
          <button id="expandAll" class="mini">Expand all</button>
          <button id="collapseAll" class="mini">Collapse all</button>
        </div>
        <div class="toc">
          <a href="#q1">1</a><a href="#q2">2</a><a href="#q3">3</a><a href="#q4">4</a>
          <a href="#q5">5</a><a href="#q6">6</a><a href="#q7">7</a><a href="#q8">8</a>
          <a href="#q9">9</a><a href="#q10">10</a><a href="#q11">11</a><a href="#q12">12</a>
          <a href="#q13">13</a><a href="#q14">14</a>
        </div>

        <details id="q1" class="faq-item"><summary>1. What is this event about?</summary>
          <p>This is a daily leaderboard competition on Pragmatic Play games, running from 1st October to 31st October 2025. Players compete based on their daily turnover. The higher your turnover, the higher you rank, and the better the prize you‚Äôll receive.</p>
        </details>
        <details id="q2" class="faq-item"><summary>2. How do I participate?</summary>
          <p>Simply play any Pragmatic Play slot games during the event period. Your turnover (total bets) will be tracked automatically.</p>
        </details>
        <details id="q3" class="faq-item"><summary>3. How are prizes distributed?</summary>
          <p>Each day, the Top 20 players by turnover win a share of the $5,000 daily prize pool: 1st Place: $1,500 ‚Ä¢ 2nd‚Äì5th: $500 each ‚Ä¢ 6th‚Äì10th: $200 each ‚Ä¢ 11th‚Äì20th: $50 each.</p>
        </details>
        <details id="q4" class="faq-item"><summary>4. What is the total prize pool?</summary>
          <p>The event runs for the month with a total pool of $150,000, split into $5,000 daily prizes.</p>
        </details>
        <details id="q5" class="faq-item"><summary>5. When does the leaderboard reset?</summary>
          <p>The leaderboard resets daily at 00:00 (Brazil local time). Each new day starts a fresh competition.</p>
        </details>
        <details id="q6" class="faq-item"><summary>6. How will I know my rank?</summary>
          <p>You can check the live leaderboard on our site‚Äôs inbox. If you‚Äôre not in the Top 20, you can still see your current ranking by entering your username.</p>
        </details>
        <details id="q7" class="faq-item"><summary>7. When will I receive my prize?</summary>
          <p>Daily leaderboard prizes will be distributed the next day at 12:00 PM. You‚Äôll see your winnings automatically credited to your account.</p>
        </details>
        <details id="q8" class="faq-item"><summary>8. What happens if there is a tie?</summary>
          <p>If two players have the same turnover, the player who reached it earlier in the day will rank higher.</p>
        </details>
        <details id="q9" class="faq-item"><summary>9. Can I win multiple days?</summary>
          <p>Yes. You can win every day during the event ‚Äî there are no limits.</p>
        </details>
        <details id="q10" class="faq-item"><summary>10. Are Free Spins or bonuses included in the leaderboard?</summary>
          <p>Yes, turnover from both cash and bonus play on Pragmatic Play slots counts. Other slot games and game categories do not count.</p>
        </details>
        <details id="q11" class="faq-item"><summary>11. Who is eligible?</summary>
          <p>All players who place bets on Pragmatic Play slot games throughout the month.</p>
        </details>
        <details id="q12" class="faq-item"><summary>12. Do wagering requirements apply to prizes?</summary>
          <p>Cash prizes: credited with x1 wagering.</p>
        </details>
        <details id="q13" class="faq-item"><summary>13. Can prizes be exchanged for other rewards?</summary>
          <p>No. Prizes are non-transferable and cannot be exchanged.</p>
        </details>
        <details id="q14" class="faq-item"><summary>14. Terms &amp; conditions</summary>
          <p>Rico.bet reserves the right to disqualify any players found to be engaging in fraud, scams, multiple accounts, or any activity that violates the integrity of the promotion. All other Rico.bet General Terms &amp; Conditions apply.</p>
        </details>
      </div>
    </details>
  </div>

<script>
/* ===== CONFIG (unchanged) ===== */
const DATA_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRmj-_miuOyDdV2cshF2M_g6aaVcNqtChyeg5PII28oaWQHPFVPiQzogRBLOATha5ug0Vh2t6HUgIIP/pub?output=csv";
const EVENT_START_YMD  = "2025-09-23";
const EVENT_END_YMD    = "2025-10-31";
const CURRENT_TZ = "America/Sao_Paulo";
const CURRENCY = { symbol: "$", code: "USD" };

/* ===== Elements ===== */
const $ = s=>document.querySelector(s);
const rowsEl = $('#rows'), updatedEl = $('#lastUpdated'), boardDateEl = $('#boardDate');
const refreshBtn = $('#refresh'), datePicker = $('#datePicker'), todayBtn = $('#quickToday'), yestBtn = $('#quickYesterday');
const searchInput = $('#searchInput'), searchBtn = $('#searchBtn'), searchResult = $('#searchResult');

/* ===== Helpers ===== */
const fmtMoney = n => `${CURRENCY.symbol} ${Number(n||0).toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2})}`;
const pad2 = n => String(n).padStart(2,'0');
const toTZ = (d=new Date(), tz=CURRENT_TZ, opts={}) => new Intl.DateTimeFormat('en-CA', { timeZone: tz, ...opts });
const ymdInTZ = d => toTZ(d, CURRENT_TZ, {year:'numeric',month:'2-digit',day:'2-digit'}).format(d);
const cmpYmd = (a,b)=>a.localeCompare(b);
const clampYmd = ymd => cmpYmd(ymd,EVENT_START_YMD)<0?EVENT_START_YMD : cmpYmd(ymd,EVENT_END_YMD)>0?EVENT_END_YMD : ymd;

/* ===== Countdown (Brazil midnight) ===== */
function tzOffsetMillisAt(date = new Date(), tz = CURRENT_TZ){
  const partsFor = (z)=> new Intl.DateTimeFormat('en-CA', {
    timeZone:z,hourCycle:'h23',year:'numeric',month:'2-digit',day:'2-digit',
    hour:'2-digit',minute:'2-digit',second:'2-digit'
  }).formatToParts(date).reduce((a,p)=>{a[p.type]=p.value;return a;}, {});
  const utc = partsFor('UTC'), tzz = partsFor(tz);
  const utcEpoch = Date.parse(`${utc.year}-${utc.month}-${utc.day}T${utc.hour}:${utc.minute}:${utc.second}Z`);
  const tzEpoch  = Date.parse(`${tzz.year}-${tzz.month}-${tzz.day}T${tzz.hour}:${tzz.minute}:${tzz.second}Z`);
  return tzEpoch - utcEpoch;
}
function nextMidnightInTZ(tz = CURRENT_TZ){
  const now = new Date();
  const parts = toTZ(now, tz, {year:'numeric',month:'2-digit',day:'2-digit'}).formatToParts(now)
                 .reduce((a,p)=>{a[p.type]=p.value;return a;}, {});
  const Y = +parts.year, M = +parts.month, D = +parts.day;
  const offset = tzOffsetMillisAt(now, tz);
  const targetUtcMs = Date.UTC(Y, M-1, D+1, 0,0,0) - offset;
  return new Date(targetUtcMs);
}
(function countdown(){
  const rings = {
    h: document.querySelector('.ring[data-unit="h"] .value'),
    m: document.querySelector('.ring[data-unit="m"] .value'),
    s: document.querySelector('.ring[data-unit="s"] .value'),
  };
  const fgH = document.querySelector('.ring[data-unit="h"] .fg');
  const fgM = document.querySelector('.ring[data-unit="m"] .fg');
  const fgS = document.querySelector('.ring[data-unit="s"] .fg');
  const CIRC = 2 * Math.PI * 30;
  [fgH,fgM,fgS].forEach(el=>{ el.style.strokeDasharray=`${CIRC}`; });

  function tick(){
    const target = nextMidnightInTZ();
    const now = new Date();
    let diff = target - now; if (diff < 0) diff = 0;

    const h = Math.floor(diff/3600000);
    const m = Math.floor((diff%3600000)/60000);
    const s = Math.floor((diff%60000)/1000);

    const old = {h:rings.h.textContent, m:rings.m.textContent, s:rings.s.textContent};
    const nh = pad2(h), nm = pad2(m), ns = pad2(s);
    rings.h.textContent = nh; rings.m.textContent = nm; rings.s.textContent = ns;
    ['h','m','s'].forEach(k=>{ if (old[k]!==({h:nh,m:nm,s:ns}[k])) { rings[k].classList.add('bump'); setTimeout(()=>rings[k].classList.remove('bump'),150); } });

    fgH.style.strokeDashoffset = `${CIRC * (1 - Math.min(1, h/24))}`;
    fgM.style.strokeDashoffset = `${CIRC * (1 - Math.min(1, m/60))}`;
    fgS.style.strokeDashoffset = `${CIRC * (1 - Math.min(1, s/60))}`;

    requestAnimationFrame(()=>setTimeout(tick, 250));
  }
  tick();
})();

/* ===== CSV loader & leaderboard ===== */
let cache = [];
async function loadCSV(){
  const url = DATA_CSV_URL + (DATA_CSV_URL.includes('?')?'&':'?') + 't=' + Date.now();
  const res = await fetch(url, {cache:'no-store'});
  if(!res.ok) throw new Error('CSV fetch failed');
  const text = await res.text();

  const lines = text.split(/\r?\n/).filter(Boolean);
  const out = [];
  for (let i=1;i<lines.length;i++){
    const raw = lines[i].split(',');
    if (raw.length < 3) continue;
    const date = raw[0].trim();
    const rank = Number(raw[1]?.trim() || 0);
    const username = (raw[2]||'').trim();
    const turnover = Number(String(raw[3]||'0').replace(/[$,\s]/g,''));
    if (!date || !username) continue;
    out.push({date, rank, name: username, amount: isNaN(turnover)?0:turnover});
  }
  cache = out;

  const updated = new Intl.DateTimeFormat('en-US',{
    timeZone: CURRENT_TZ, year:'numeric',month:'numeric',day:'numeric',
    hour:'numeric',minute:'2-digit',second:'2-digit'
  }).format(new Date());
  const el = document.getElementById('lastUpdated');
  if (el) el.textContent = updated;
}
function maskUsername(name){
  const s = String(name||'');
  if(s.length<=6){ const keep=Math.max(1,Math.floor(s.length/3)); return `${s.slice(0,keep)}****${s.slice(-keep)}`; }
  const left=Math.floor((s.length-4)/2); return s.slice(0,left)+'****'+s.slice(left+4);
}
function renderDay(ymd){
  const bd = document.getElementById('boardDate');
  if (bd) bd.textContent = ymd;
  rowsEl.innerHTML = '';
  const dayRows = cache.filter(r=>r.date===ymd);
  if (!dayRows.length){
    rowsEl.innerHTML = `<div class="row"><div></div><div>No results for ${ymd}.</div><div></div></div>`;
    return;
  }
  const withRank = dayRows.some(r=>r.rank>0);
  const sorted = dayRows.slice().sort((a,b)=>{
    if(withRank){
      const ar = a.rank||99999, br = b.rank||99999;
      return ar - br;
    }
    return (b.amount||0)-(a.amount||0);
  });

  const top20 = sorted.slice(0,20);
  for(const r of top20){
    const row = document.createElement('div');
    row.className='row';
    row.dataset.nameOriginal = r.name;
    const dot = r.rank===1?'top1':r.rank===2?'top2':r.rank===3?'top3':'';
    const rankShown = r.rank>0 ? r.rank : (sorted.indexOf(r)+1);
    row.innerHTML = `
      <div><span class="rank ${dot}">${rankShown}</span></div>
      <div class="player"><span class="avatar" aria-hidden="true"></span><span class="mask">${maskUsername(r.name)}</span></div>
      <div class="payout">${fmtMoney(r.amount)}</div>`;
    rowsEl.appendChild(row);
  }
}
function findRank(ymd, name){
  const dayRows = cache.filter(r=>r.date===ymd);
  if (!dayRows.length) return null;
  const withRank = dayRows.some(r=>r.rank>0);
  const sorted = withRank
    ? dayRows.slice().sort((a,b)=>(a.rank||99999)-(b.rank||99999))
    : dayRows.slice().sort((a,b)=>(b.amount||0)-(a.amount||0));
  const idx = sorted.findIndex(r => String(r.name).toLowerCase()===String(name).toLowerCase());
  if (idx===-1) return null;
  return { rank: withRank ? (sorted[idx].rank||idx+1) : idx+1, name: sorted[idx].name };
}
async function refreshFor(ymd){ await loadCSV(); renderDay(ymd); }

/* ===== INIT ===== */
(async function init(){
  const dp = document.getElementById('datePicker');
  dp.min = EVENT_START_YMD; dp.max = EVENT_END_YMD;
  const today = clampYmd( ymdInTZ(new Date()) );
  dp.value = today;

  await refreshFor(today);

  document.getElementById('refresh').addEventListener('click', async (e)=>{ e.preventDefault(); await refreshFor(dp.value); });
  dp.addEventListener('change', ()=> renderDay(clampYmd(dp.value)));
  document.getElementById('quickToday').addEventListener('click', async ()=>{ const y = clampYmd( ymdInTZ(new Date()) ); dp.value=y; await refreshFor(y); });
  document.getElementById('quickYesterday').addEventListener('click', async ()=>{
    const n = new Date(); n.setDate(n.getDate()-1);
    const y = clampYmd( ymdInTZ(n) ); dp.value=y; await refreshFor(y);
  });

  function doSearch(){
    const q = (searchInput.value||'').trim();
    searchResult.textContent='';
    if(!q) return;
    const ymd = dp.value;
    const hit = findRank(ymd, q);
    if(!hit){ searchResult.textContent = `No exact match for "${q}" on ${ymd}.`; return; }
    const topRow = Array.from(rowsEl.children).find(el => el.dataset.nameOriginal?.toLowerCase()===q.toLowerCase());
    searchResult.textContent = hit.rank<=20 ? `‚úÖ ${q} is #${hit.rank} today.` : `‚ÑπÔ∏è ${q} is #${hit.rank} today ‚Äî not in Top 20.`;
    if(topRow){ rowsEl.querySelectorAll('.hit').forEach(e=>e.classList.remove('hit')); topRow.classList.add('hit'); topRow.scrollIntoView({behavior:'smooth',block:'center'}); setTimeout(()=>topRow.classList.remove('hit'),2500); }
  }
  document.getElementById('searchBtn').addEventListener('click', doSearch);
  document.getElementById('searchInput').addEventListener('keydown', e=>{ if(e.key==='Enter') doSearch(); });

  // Share links (custom copy)
  const shareUrl = location.href.split('#')[0];
  const textMsg = 'I‚Äôm chasing glory on the reels‚Ä¶ come join the battle for daily prizes!';
  document.getElementById('shareTg').href = `https://t.me/share/url?url=${encodeURIComponent(shareUrl)}&text=${encodeURIComponent(textMsg)}`;
  document.getElementById('shareWa').href = `https://api.whatsapp.com/send?text=${encodeURIComponent(textMsg + ' üëâ ' + shareUrl)}`;

  // FAQ open/close all (inner items)
  const expandAll = document.getElementById('expandAll');
  const collapseAll = document.getElementById('collapseAll');
  expandAll.addEventListener('click', ()=> document.querySelectorAll('.faq-item').forEach(d=>d.open=true));
  collapseAll.addEventListener('click', ()=> document.querySelectorAll('.faq-item').forEach(d=>d.open=false));
})();
</script>
</body>
</html>

